# 医学宝典 - 开发流程规划

> 基于 PRD v3.0 制定的详细开发计划，按功能模块拆分为可执行的开发任务。

---

## 📋 开发阶段总览

```
Phase 1: 基础架构与数据层
Phase 2: Admin 后台系统
Phase 3: Web 学员端核心功能
Phase 4: 推广分销系统
Phase 5: 讲义与重点功能
Phase 6: 微信小程序（第二阶段）
```

---

## Phase 1: 基础架构与数据层

### 1.1 项目初始化

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P1-01 | 后端项目搭建 | Node.js + NestJS 框架初始化，配置 TypeScript、ESLint、Prettier | - |
| P1-02 | 前端项目搭建 | React + TypeScript + Vite，配置路由、状态管理（Zustand）、Ant Design | - |
| P1-03 | 数据库环境 | MySQL 8.0 + Redis 环境配置，Docker Compose 编排 | - |
| P1-04 | 开发环境配置 | 环境变量管理、开发/测试/生产环境区分 | - |

### 1.2 数据库设计

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P1-05 | 用户相关表 | users、user_devices、user_tokens、verification_codes | U-01~U-07 |
| P1-06 | SKU 树结构表 | professions、levels、subjects | 1.2 SKU架构 |
| P1-07 | 题库相关表 | papers、questions、user_answers、wrong_questions | Q-01~Q-06 |
| P1-08 | 讲义相关表 | lectures、lecture_highlights、reading_progress | L-01~L-05 |
| P1-09 | 订单支付表 | orders、subscriptions、payments | P-01~P-04 |
| P1-10 | 分销相关表 | commissions、withdrawals、commission_configs | A-01~A-05 |
| P1-11 | 系统配置表 | system_configs（注册开关、设备数限制等） | U-03, U-04 |

### 1.3 基础服务层

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P1-12 | Redis 缓存服务 | 封装缓存操作，Session 管理，热门数据缓存策略 | NFR |
| P1-13 | 文件存储服务 | OSS/MinIO 集成，PDF 文件上传与防盗链 | L-01, NFR |
| P1-14 | 短信服务 | 阿里云/腾讯云短信 SDK 集成 | U-01, 本地化 |
| P1-15 | 日志服务 | 请求日志、错误日志、操作审计日志 | - |

---

## Phase 2: Admin 后台系统

### 2.1 Admin 鉴权

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P2-01 | Admin 登录 | 管理员账号密码登录，JWT Token 管理 | 1.3 角色 |
| P2-02 | 权限中间件 | 角色校验（Admin/Teacher），接口权限控制 | 1.3 角色 |

### 2.2 分类树管理 (AD-01)

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P2-03 | 大类管理 | 职业大类的增删改查，排序功能 | AD-01 |
| P2-04 | 等级管理 | 等级的增删改查，关联大类，佣金比例配置 | AD-01, A-02 |
| P2-05 | 科目管理 | 科目的增删改查，关联等级 | AD-01 |
| P2-06 | 分类树展示 | 树形结构可视化展示与操作 | AD-01 |

### 2.3 定价管理 (P-01)

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P2-07 | SKU 定价配置 | 针对【大类+等级】配置月卡/季卡/年卡价格 | P-01 |
| P2-08 | 价格历史记录 | 记录价格变更历史（可选） | P-01 |

### 2.4 内容录入 (AD-02)

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P2-09 | 试卷管理 | 创建试卷（真题/模拟题），关联科目，设置年份/套数 | AD-02, Q-01 |
| P2-10 | 题目手动录入 | 单题录入：题干、选项A/B/C/D、正确答案、解析 | AD-02 |
| P2-11 | 题目批量导入 | Excel 模板下载、文件上传、数据校验、批量入库 | AD-02 |
| P2-12 | 题目编辑/删除 | 修改题目内容，删除题目（级联处理错题本） | AD-02, Q-06 |
| P2-13 | 讲义管理 | PDF 上传、关联科目、讲义列表管理 | AD-02, L-01 |

### 2.5 用户管理 (AD-03)

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P2-14 | 用户列表 | 分页查询、搜索（手机号/邮箱/昵称）、筛选（状态） | AD-03 |
| P2-15 | 用户详情 | 查看用户信息、订阅记录、答题记录、推广关系 | AD-03 |
| P2-16 | 用户封禁/解封 | 封禁账号、解封账号、封禁原因记录 | AD-03 |
| P2-17 | 系统配置 | 注册开关、单账号最大设备数配置 | AD-03, U-03, U-04 |

### 2.6 工单与财务 (AD-04)

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P2-18 | 提现工单列表 | 工单列表、状态筛选、金额统计 | AD-04, A-04 |
| P2-19 | 工单审核通过 | 审核通过 → 打款中 → 确认打款 → 已完成 | AD-04, A-04 |
| P2-20 | 工单审核拒绝 | 填写拒绝原因（必填）、设置退回金额、状态变更 | AD-04, A-04 |
| P2-21 | 余额流水查询 | 用户余额变动记录查询、导出 | AD-04 |

### 2.7 数据看板 (AD-05)

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P2-22 | 用户数据统计 | 新增用户趋势图（日/周/月）、DAU/MAU 统计 | AD-05 |
| P2-23 | 销售数据统计 | 销售额统计（按等级、按时间段）、订单转化率 | AD-05 |
| P2-24 | 内容数据统计 | 热门科目/试卷排行、平均正确率、高频错题 | AD-05 |
| P2-25 | 推广数据统计 | 推广效果排行、佣金排行榜 | AD-05 |
| P2-26 | 报表导出 | 各类报表 Excel 导出功能 | AD-05 |

---

## Phase 3: Web 学员端核心功能

### 3.1 注册与登录 (U-01, U-02)

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P3-01 | 注册页面 | 手机号/邮箱注册表单，邀请码输入（URL自动填充锁定） | U-01, U-02 |
| P3-02 | 发送验证码 | 手机/邮箱验证码发送，60秒倒计时，防刷限制 | U-01 |
| P3-03 | 注册接口 | 校验验证码、邀请码有效性、创建用户、绑定推广关系 | U-01, U-02 |
| P3-04 | 登录页面 | 手机号/邮箱 + 验证码/密码登录 | U-01 |
| P3-05 | 登录接口 | 验证身份、生成 Token、设备互踢逻辑 | U-01, U-04 |
| P3-06 | 微信扫码登录 | Web 端微信扫码授权登录（预留） | U-01 |
| P3-07 | 注册熔断检测 | 前端检测注册开关状态，隐藏入口或提示 | U-03 |

### 3.2 个人中心

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P3-08 | 个人中心页面 | 用户信息展示、各功能入口 | U-05, U-06 |
| P3-09 | 考种切换 | 已购等级列表、切换当前考种、全局状态刷新 | U-05 |
| P3-10 | 设备管理 | 当前登录设备列表（型号、IP、时间）、主动踢出设备 | U-06 |
| P3-11 | 账号注销 | 注销申请、二次确认、7天冷静期提示 | U-07 |
| P3-12 | 修改密码 | 旧密码验证或验证码验证，设置新密码 | U-01 |

### 3.3 商品与支付 (P-01~P-04)

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P3-13 | 商品列表页 | 大类 → 等级 展示，价格档位（月/季/年） | P-01 |
| P3-14 | 订阅确认页 | 选择等级 + 时长，显示金额，选择支付方式 | P-02 |
| P3-15 | 支付宝支付 | 支付宝 PC 网页支付集成 | P-02 |
| P3-16 | 微信支付 | 微信 Native 支付（扫码）集成 | P-02 |
| P3-17 | 支付回调处理 | 支付成功回调、订单状态更新、订阅生效 | P-02 |
| P3-18 | 订阅记录页 | 我的订阅列表、到期时间、续费入口 | P-04 |
| P3-19 | 权限拦截中间件 | 访问受限资源时校验订阅状态，403 跳转收银台 | P-03 |

### 3.4 刷题系统 (Q-01~Q-06)

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P3-20 | 科目列表页 | 当前等级下的科目列表 | Q-01 |
| P3-21 | 试卷列表页 | 科目下的试卷列表（真题/模拟题），显示年份套数 | Q-01 |
| P3-22 | 练习模式-顺序 | 逐题展示、选择后立即判分、显示解析 | Q-03 |
| P3-23 | 练习模式-随机 | 题目随机打乱后逐题展示 | Q-03 |
| P3-24 | 考试模式 | 全屏沉浸、倒计时（可选）、无实时答案 | Q-02 |
| P3-25 | 考试交卷 | 统一判分、生成结果、跳转结果页 | Q-02 |
| P3-26 | 考试结果页 | 总分、正确率、错题列表、全卷解析入口 | Q-02 |
| P3-27 | 答题记录保存 | 每道题作答记录入库，支持断点续答 | Q-02, Q-03 |
| P3-28 | 错题自动入库 | 做错的题自动进入错题本，记录错误次数/时间 | Q-04 |

### 3.5 错题本 (Q-04, Q-05)

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P3-29 | 错题本列表 | 错题列表、按科目筛选、错误次数/时间显示 | Q-04 |
| P3-30 | 错题详情 | 查看错题题目、用户答案、正确答案、解析 | Q-04 |
| P3-31 | 错题组卷入口 | 选择科目（单选/全选）、设置题数 | Q-05 |
| P3-32 | 错题组卷生成 | 随机抽取错题生成临时试卷 | Q-05 |
| P3-33 | 错题组卷练习 | 顺序/随机模式可选，答题流程 | Q-05 |
| P3-34 | 错题移出确认 | 答对后弹窗确认是否移出，确认后逻辑删除 | Q-05 |

---

## Phase 4: 推广分销系统

### 4.1 推广功能 (A-01~A-05)

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P4-01 | 推广中心页面 | 邀请码展示、推广链接、海报入口、数据概览 | A-05 |
| P4-02 | 推广海报生成 | Canvas 生成带二维码的海报图片，支持下载 | A-05 |
| P4-03 | 我的下线列表 | 下线用户列表、注册时间、消费金额 | A-01 |
| P4-04 | 佣金明细 | 佣金记录列表、来源用户、金额、状态（冻结/可用） | A-03 |
| P4-05 | 余额与提现 | 当前余额显示、提现申请入口 | A-03, A-04 |
| P4-06 | 提现申请 | 填写金额、收款方式（支付宝/银行卡）、提交工单 | A-04 |
| P4-07 | 提现记录 | 提现工单列表、状态跟踪 | A-04 |

### 4.2 佣金计算后端

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P4-08 | 佣金计算服务 | 订单支付成功后，计算上线佣金，写入余额 | A-01, A-02, A-03 |
| P4-09 | 佣金冻结期 | T+N 天冻结期逻辑，冻结期后自动解冻 | A-03 |
| P4-10 | 余额扣减 | 提现完成后扣减余额，记录流水 | A-04 |

---

## Phase 5: 讲义与重点功能

### 5.1 讲义阅读 (L-01, L-02)

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P5-01 | 讲义列表页 | 当前等级下的讲义列表 | L-01 |
| P5-02 | PDF 阅读器集成 | react-pdf 或 pdf.js 集成，分页加载 | L-01 |
| P5-03 | 阅读器功能 | 缩放、翻页、目录跳转 | L-01 |
| P5-04 | 阅读进度保存 | 记录最后停留页码，下次自动跳转 | L-02 |

### 5.2 教师画重点 (L-03)

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P5-05 | 教师端讲义列表 | 教师可操作的讲义列表 | L-03 |
| P5-06 | 画重点工具栏 | 高亮笔、下划线、颜色选择、橡皮擦 | L-03 |
| P5-07 | 画重点交互 | 鼠标/触摸涂抹，实时预览 | L-03 |
| P5-08 | 坐标数据保存 | 保存标注坐标 JSON 到后端（按页存储） | L-03 |
| P5-09 | 重点编辑/删除 | 修改已画重点、删除重点区域 | L-03 |

### 5.3 重点展示 (L-04, L-05)

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P5-10 | 重点数据加载 | 翻页时按页请求坐标数据 | L-04 |
| P5-11 | 重点渲染层 | PDF 上层 Canvas 渲染半透明色块 | L-04 |
| P5-12 | 重点索引目录 | 提取被标注页码，生成快速跳转目录 | L-05 |

---

## Phase 6: 微信小程序（第二阶段）

### 6.1 小程序基础

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P6-01 | 小程序项目搭建 | Uni-app + Vue3 + TypeScript 初始化 | 技术栈 |
| P6-02 | 微信登录 | 微信授权登录、获取 openid/unionid | MP-01 |
| P6-03 | 账号绑定 | 绑定已有 Web 端账号（手机号验证） | MP-01 |

### 6.2 核心功能复刻

| 任务ID | 任务名称 | 详细描述 | 关联PRD |
|--------|----------|----------|---------|
| P6-04 | 刷题功能 | 考试模式、练习模式、错题本（复用 Web 端逻辑） | MP-02 |
| P6-05 | 讲义阅读 | 小程序 PDF 阅读器、重点展示 | MP-03 |
| P6-06 | 微信支付 | 小程序微信支付集成 | MP-04 |
| P6-07 | 推广分销 | 海报生成、分享到好友/群、提现申请 | MP-05 |
| P6-08 | 个人中心 | 考种切换、设备管理、订阅管理 | MP-06 |

---

## 🔧 通用任务

| 任务ID | 任务名称 | 详细描述 |
|--------|----------|----------|
| G-01 | 接口文档 | Swagger/OpenAPI 接口文档自动生成 |
| G-02 | 错误处理 | 统一错误码定义、前后端错误处理规范 |
| G-03 | 单元测试 | 核心业务逻辑单元测试覆盖 |
| G-04 | E2E 测试 | 关键用户流程端到端测试 |
| G-05 | 部署配置 | CI/CD 流水线、Docker 镜像构建、K8s 部署 |
| G-06 | 监控告警 | 应用性能监控、错误告警、日志收集 |

---

## 📊 任务统计

| 阶段 | 任务数量 | 说明 |
|------|----------|------|
| Phase 1 | 15 | 基础架构与数据层 |
| Phase 2 | 26 | Admin 后台系统 |
| Phase 3 | 34 | Web 学员端核心功能 |
| Phase 4 | 10 | 推广分销系统 |
| Phase 5 | 12 | 讲义与重点功能 |
| Phase 6 | 8 | 微信小程序 |
| 通用 | 6 | 测试、部署、监控 |
| **合计** | **111** | - |

---

## 📝 开发规范

### 代码规范
- TypeScript 严格模式
- ESLint + Prettier 统一代码风格
- 提交信息遵循 Conventional Commits

### 分支策略
```
main        ← 生产环境
├── develop ← 开发环境
│   ├── feature/xxx  ← 功能分支
│   ├── fix/xxx      ← 修复分支
│   └── refactor/xxx ← 重构分支
```

### API 规范
- RESTful 风格
- 统一响应格式：`{ code, message, data }`
- 分页参数：`page`, `pageSize`
- 时间格式：ISO 8601（后端存储 UTC，前端显示北京时间）

---

## ✅ 验收标准

每个任务完成需满足：
1. 功能符合 PRD 描述
2. 代码通过 Review
3. 单元测试覆盖（如适用）
4. 接口文档更新
5. 无 ESLint 错误
