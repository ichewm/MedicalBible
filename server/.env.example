# 医学宝典 - 环境变量配置示例
# 复制此文件为 .env.local 并填写实际配置
#
# 配置验证说明：
# - 应用启动时会自动验证所有必需的环境变量
# - 缺少或无效的配置会导致应用启动失败并显示详细错误信息
# - 查看错误信息中的"💡"部分获取修复建议

# ==================== 应用配置 ====================
# 运行环境：development, production, test
# Required: No
# Default: development
# Validation: 必须是 development, production, test 之一
NODE_ENV=development

# 服务端口
# Required: No
# Default: 3000
# Validation: 1-65535 之间的整数
PORT=3000

# ==================== CORS 跨域配置 ====================
# 允许的跨域源地址
# Required: No (开发环境有默认值)
# Default (dev): http://localhost:5173, http://localhost:3000
# Default (prod): false (拒绝所有请求)
# Validation: 逗号分隔的URL列表，生产环境不能使用 "*"
# 格式: "https://domain1.com,https://domain2.com"
# Security: 生产环境使用 "*" 通配符会导致启动失败
CORS_ORIGIN=http://localhost:5173

# ==================== 数据库配置 ====================
# 数据库主机地址
# Required: No
# Default: localhost
DB_HOST=localhost

# 数据库端口
# Required: No
# Default: 3306
# Validation: 1-65535 之间的整数
DB_PORT=3306

# 数据库用户名
# Required: No
# Default: root
DB_USERNAME=root

# 数据库密码
# Required: No
# Default: (空字符串)
DB_PASSWORD=your_password_here

# 数据库名称
# Required: No
# Default: medical_bible
DB_DATABASE=medical_bible

# 数据库连接池配置
# 连接池最大连接数（默认: 20）
# 生产环境建议: 根据并发量和数据库性能调整，通常为 (CPU核心数 * 2) + 磁盘数
DB_POOL_MAX=20
# 连接池最小连接数（默认: 5）
# 建议设置为 DB_POOL_MAX 的 20-30%
DB_POOL_MIN=5
# 获取连接的超时时间，单位: 毫秒（默认: 30000）
DB_POOL_ACQUIRE_TIMEOUT=30000
# 连接空闲超时时间，单位: 毫秒（默认: 300000，即5分钟）
# 空闲超过此时长的连接将被释放
DB_POOL_IDLE_TIMEOUT=300000
# 连接最大生命周期，单位: 毫秒（默认: 1800000，即30分钟）
# 连接超过此时长将被关闭并重建
DB_POOL_MAX_LIFETIME=1800000
# 连接超时时间，单位: 毫秒（默认: 60000，即1分钟）
DB_CONNECTION_TIMEOUT=60000
# 查询超时时间，单位: 毫秒（默认: 60000，即1分钟）
DB_QUERY_TIMEOUT=60000

# ==================== Redis 配置 ====================
# Redis 主机地址
# Required: No
# Default: localhost
REDIS_HOST=localhost

# Redis 端口
# Required: No
# Default: 6379
# Validation: 1-65535 之间的整数
REDIS_PORT=6379

# Redis 密码
# Required: No
# Default: (无密码)
REDIS_PASSWORD=

# Redis 数据库索引
# Required: No
# Default: 0
# Validation: 0-15 之间的整数
REDIS_DB=0

# ==================== JWT 配置 ====================
# Access Token 签名密钥
# Required: Yes (所有环境)
# Validation: 字符串，最少32个字符
# Security: 必须设置强随机密钥，应用启动时会验证
JWT_SECRET=your_jwt_secret_here_please_change_it_minimum_32_chars

# Access Token 过期时间
# Required: No
# Default: 15m
# Example: 15m, 1h, 7d
JWT_ACCESS_EXPIRES=15m

# Refresh Token 签名密钥
# Required: No (如果未设置，使用 JWT_SECRET)
# Validation: 字符串，最少32个字符
# Security: 建议使用不同于 JWT_SECRET 的独立密钥以提高安全性
JWT_REFRESH_SECRET=your_jwt_refresh_secret_here_different_from_access_min_32

# Refresh Token 过期时间
# Required: No
# Default: 7d
# Example: 7d, 30d
JWT_REFRESH_EXPIRES=7d

# ==================== 压缩配置 ====================
# 是否启用 HTTP 响应压缩
# Required: No
# Default: true
# Validation: "true" 或 "false"
COMPRESSION_ENABLED=true

# 压缩级别 (1=最快, 6=平衡, 9=最高压缩率)
# Required: No
# Default: 6
# Validation: 1, 6, 或 9
COMPRESSION_LEVEL=6

# 压缩阈值（字节），小于此大小的响应不压缩
# Required: No
# Default: 1024
# Validation: 非负整数
COMPRESSION_THRESHOLD=1024

# ==================== 限流配置 ====================
# 是否启用限流
# Required: No
# Default: true
# Validation: "true" 或 "false"
RATE_LIMIT_ENABLED=true

# 全局限流配置（所有请求的总体限流）
# Required: No
# Default: MAX=1000, WINDOW=60
RATE_LIMIT_GLOBAL_MAX=1000
RATE_LIMIT_GLOBAL_WINDOW=60

# 认证端点限流配置（登录、刷新令牌等）
# Required: No
# Default: MAX=10, WINDOW=3600
RATE_LIMIT_AUTH_MAX=10
RATE_LIMIT_AUTH_WINDOW=3600

# 普通端点限流配置
# Required: No
# Default: MAX=30, WINDOW=60
RATE_LIMIT_STANDARD_MAX=30
RATE_LIMIT_STANDARD_WINDOW=60

# 验证码端点限流配置
# Required: No
# Default: MAX=10, WINDOW=86400
RATE_LIMIT_VERIFICATION_MAX=10
RATE_LIMIT_VERIFICATION_WINDOW=86400

# 严格端点限流配置（注册、重置密码等）
# Required: No
# Default: MAX=5, WINDOW=60
RATE_LIMIT_STRICT_MAX=5
RATE_LIMIT_STRICT_WINDOW=60

# 宽松端点限流配置
# Required: No
# Default: MAX=100, WINDOW=60
RATE_LIMIT_RELAXED_MAX=100
RATE_LIMIT_RELAXED_WINDOW=60

# 限流键前缀
# Required: No
# Default: rate_limit
RATE_LIMIT_KEY_PREFIX=rate_limit

# Redis 不可用时是否跳过限流检查
# Required: No
# Default: false
# Validation: "true" 或 "false"
# Recommendation: 生产环境建议设为 false
RATE_LIMIT_SKIP_ON_REDIS_ERROR=false

# ==================== 日志配置 ====================
# 日志级别
# Required: No
# Default: development=debug, production=info
# Validation: fatal, error, warn, info, debug, trace, silent
LOG_LEVEL=info

# 日志目录
# Required: No
# Default: logs
LOG_DIR=logs

# 日志文件最大大小
# Required: No
# Default: 100M
# Example: 100M, 1G
LOG_MAX_SIZE=100M

# 日志文件保留数量
# Required: No
# Default: 10
# Validation: 正整数
LOG_MAX_FILES=10

# 日志文件保留天数
# Required: No
# Default: 30
# Validation: 正整数
LOG_RETENTION_DAYS=30

# ==================== 安全头配置 ====================
# 安全头中间件开关（默认启用）
SECURITY_ENABLED=true

# HSTS (HTTP Strict Transport Security) - 强制 HTTPS
# 仅在生产环境启用（需要 HTTPS）
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000
HSTS_INCLUDE_SUB_DOMAINS=true
HSTS_PRELOAD=false

# CSP (Content Security Policy) - 内容安全策略
# 防止 XSS 攻击，控制资源加载来源
CSP_ENABLED=true
CSP_DEFAULT_SRC='self'
CSP_SCRIPT_SRC='self'
CSP_STYLE_SRC='self','unsafe-inline'
CSP_IMG_SRC='self','data:','https:'
CSP_CONNECT_SRC='self'
CSP_FONT_SRC='self'
CSP_OBJECT_SRC='none'
CSP_MEDIA_SRC='self'
CSP_FRAME_SRC='none'
CSP_WORKER_SRC='self'
CSP_BASE_URI='self'
CSP_FORM_ACTION='self'
CSP_FRAME_ANCESTORS='none'
CSP_UPGRADE_INSECURE=true

# X-Frame-Options (已弃用，建议使用 CSP frame-ancestors)
X_FRAME_OPTIONS=DENY

# Referrer-Policy
REFERRER_POLICY=strict-origin-when-cross-origin

# 跨域策略（默认禁用，按需启用）
CROSS_ORIGIN_EMBEDDER_POLICY=false
CROSS_ORIGIN_RESOURCE_POLICY=false

# ==================== WebSocket 配置 ====================
# 每个用户最大同时连接数
# Required: No
# Default: 3
# Validation: 正整数
WS_MAX_CONNECTIONS_PER_USER=3

# 连接心跳间隔（毫秒）
# Required: No
# Default: 25000
# Validation: 正整数
WS_HEARTBEAT_INTERVAL=25000

# 连接超时时间（毫秒）
# Required: No
# Default: 60000
# Validation: 正整数
WS_CONNECTION_TIMEOUT=60000

# 消息队列过期时间（秒）
# Required: No
# Default: 604800 (7天)
# Validation: 正整数
WS_MESSAGE_QUEUE_TTL=604800

# 重连延迟初始值（毫秒）
# Required: No
# Default: 1000
# Validation: 正整数
WS_RECONNECT_DELAY_MIN=1000

# 重连延迟最大值（毫秒）
# Required: No
# Default: 30000
# Validation: 正整数
WS_RECONNECT_DELAY_MAX=30000

# 重连尝试次数限制
# Required: No
# Default: 10
# Validation: 正整数
WS_MAX_RECONNECT_ATTEMPTS=10

# ==================== 阿里云 OSS 配置 ====================
# OSS 访问密钥 ID
OSS_ACCESS_KEY_ID=your_access_key_id

# OSS 访问密钥 Secret
OSS_ACCESS_KEY_SECRET=your_access_key_secret

# OSS 存储桶名称
OSS_BUCKET=medical-bible

# OSS 区域
OSS_REGION=oss-cn-beijing

# OSS 端点
OSS_ENDPOINT=https://oss-cn-beijing.aliyuncs.com

# ==================== 加密密钥 ====================
# 用于加密敏感配置（如支付密钥）
# Required: No (但强烈建议在生产环境设置)
# Validation: 字符串
# Security: 生产环境必须设置此值，否则使用不安全的默认密钥
ENCRYPTION_KEY=your_random_encryption_key_at_least_32_chars

# ==================== 以下配置已迁移到数据库管理 ====================
# 短信、邮件、支付等配置现在通过后台管理界面配置
# 存储在 system_configs 表中，敏感信息会自动加密

# ==================== 健康检查配置 ====================
# 健康检查超时时间，单位: 毫秒（默认: 3000）
HEALTH_CHECK_TIMEOUT=3000
# 健康检查重试次数（默认: 3）
HEALTH_CHECK_RETRIES=3
# 数据库健康检查开关（默认: true）
HEALTH_CHECK_DATABASE=true
# Redis 健康检查开关（默认: true）
HEALTH_CHECK_REDIS=true
# 存储服务健康检查开关（默认: false，需要外部存储时启用）
HEALTH_CHECK_STORAGE=false
# 邮件服务健康检查开关（默认: false，需要时启用）
HEALTH_CHECK_EMAIL=false
# 短信服务健康检查开关（默认: false，需要时启用）
HEALTH_CHECK_SMS=false
